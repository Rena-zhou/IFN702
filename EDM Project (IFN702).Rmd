---
title: 'IFN702: Educational Data Mining project'
output:
  html_document: default
  html_notebook: default
  pdf_document: default
  word_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
###### version 1.0 --- Zhiying Zhou: 9835580

# Introduction 

This study will process, exploration, analyze and predict Student's academic performance based on a XAPI Educational Mining Datasets. 

The XAPI Educational Mining Datasets is download from the Kaggle website. It was collected from an e-Learning system called Kalboard 360 using Experience API Web service (XAPI).

The datasets consist of 480 student records and 16 features. The features are classified into three major categories: 
1.	Demographic features such as gender, grade levels, topic and nationality. 
2.	Academic background features such as educational stage, grade Level and section. 
3.	Behavioral features such as raised hand on class, opening resources, answering survey by parents, and school satisfaction.

Attributes
1 Gender - student's gender (nominal: 'Male' or 'Female') 
2 Nationality- student's nationality (nominal:' Kuwait',' Lebanon',' Egypt',' SaudiArabia',' USA',' Jordan',' Venezuela',' Iran',' Tunis',' Morocco',' Syria',' Palestine',' Iraq',' Lybia')
3 Place of birth- student's Place of birth (nominal:' Kuwait',' Lebanon',' Egypt',' SaudiArabia',' USA',' Jordan',' Venezuela',' Iran',' Tunis',' Morocco',' Syria',' Palestine',' Iraq',' Lybia')
4 Educational Stages- educational level student belongs (nominal: 'lowerlevel','MiddleSchool','HighSchool') 
5 Grade Levels- grade student belongs (nominal: 'G-01', 'G-02', 'G-03', 'G-04', 'G-05', 'G-06', 'G-07', 'G-08', 'G-09', 'G-10', 'G-11', 'G-12 ') 
6 Section ID- classroom student belongs (nominal:'A','B','C')
7 Topic- course topic (nominal:' English',' Spanish', 'French',' Arabic',' IT',' Math',' Chemistry', 'Biology', 'Science',' History',' Quran',' Geology')
8 Semester- school year semester (nominal:' First',' Second')
9 Parent responsible for student (nominal:'mom','father')
10 Raised hand- how many times the student raises his/her hand on classroom (numeric:0-100)
11- Visited resources- how many times the student visits a course content(numeric:0-100)
12 Viewing announcements-how many times the student checks the new announcements(numeric:0-100)
13 Discussion groups- how many times the student participate on discussion groups (numeric:0-100)
14 Parent Answering Survey- parent answered the surveys which are provided from school or not (nominal:'Yes','No')
15 Parent School Satisfaction- the Degree of parent satisfaction from school(nominal:'Yes','No')
16 Student Absence Days-the number of absence days for each student (nominal: above-7, under-7)

The students are classified into three numerical intervals based on their total grade/mark:

Low-Level: interval includes values from 0 to 69,
Middle-Level: interval includes values from 70 to 89,
High-Level: interval includes values from 90-100.

We will use R Studio to analyze this datasets in R programming language, and aim to achieve the following targets:

1.	Preprocess of the datasets. Clean the dataset, remove the useless columns or rows; and
2.	Explore the datasets. Explore the distribution of the datasets in different features: gender, nationality, grade, topic, parental satisfaction etc. (like girls raises more hand, more discussions in high school etc.); and
3.	Find underlying relationships. Like parent who are not satisfied and not answer survey, connection with study activity and performance (raising hand, discussion, absence, parental satisfaction, answering survey etc.); and
4.	Build prediction model, like decision tree or regression model to predict the student's academic performance.
5.	Evaluate the predictive results of models and improve the models by comparing the accuracy. 


#Task 1. Exporation of the students' academic performance datasets

#Task 1.1. Barplots of classification values distribution:


```{r}
# install libraries
library(ggplot2)
library(reshape2)
```

```{r}
# Import Uber pickups data sets
E <- read.csv("data/xAPI-Edu-Data.csv")
E
```

```{r}
str(E)
summary(E)
levels(E$Class) = c('H','M','L')
E

```

```{r}
ED <- data.frame(Gender=E$gender, Nationality=E$NationalITy, PlaceofBirth=E$PlaceofBirth, StageID=E$StageID, GradeID=E$GradeID, SectionID=E$SectionID, Topic=E$Topic, Semester=E$Semester, Relation=E$Relation, Raisehands=E$raisedhands, VisitedResources=E$VisITedResources, AnnouncementsView=E$AnnouncementsView, Discussion=E$Discussion, ParentAnsweringSurvey=E$ParentAnsweringSurvey, ParentschoolSatisfaction=E$ParentschoolSatisfaction, StudentAbsenceDays=E$StudentAbsenceDays, Class=E$Class)

```

```{r}
Gender_frequence <- as.data.frame(table(ED$Gender))
names(Gender_frequence)<- c("Gender","Counts")

ggplot(data=Gender_frequence, aes(x = Gender, y = Counts, fill=Gender))+geom_bar(stat = "identity")+ggtitle(label = "Gender Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Gender")+ylab("Counts")+ geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```



```{r}
ggplot(data = E, aes(x = gender, fill = Relation)) + geom_bar() +
    labs(x = "Gender", y = "Student Count")
```
#


```{r}
ggplot(data = E, aes(x = gender, fill = ParentAnsweringSurvey)) + geom_bar() +
    labs(x = "Gender", y = "Student Count") 
```

```{r}
ggplot(data = E, aes(x = gender, fill = ParentschoolSatisfaction)) + geom_bar() +
    labs(x = "Gender", y = "Student Count")
```

```{r}
ggplot(data = E, aes(x = gender, fill = StudentAbsenceDays)) + geom_bar() +
    labs(x = "Gender", y = "Student Count")
```
#Girls has higher 

```{r}

ggplot(data = E, aes(x = gender, fill = Class)) + geom_bar() +
    labs(x = "Gender", y = "Student Count") + scale_fill_discrete(limits=c("H","M","L"))
```


```{r}
Nationality_frequence <- as.data.frame(table(ED$Nationality))
names(Nationality_frequence)<- c("Nationality","Counts")
Nationality_frequence

ggplot(data=Nationality_frequence, aes(x = Nationality, y = Counts, fill=Nationality))+geom_bar(stat = "identity")+ggtitle(label = "Nationality Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Nationality")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```

```{r}
ggplot(data = E, aes(x = NationalITy, fill = Class)) + geom_bar() +
    labs(x = "Nationality", y = "Student Count")+theme(axis.text.x = element_text(angle=90, hjust=1))+ scale_fill_discrete(limits=c("H","M","L"))
```

```{r}
PlaceofBirth_frequence <- as.data.frame(table(ED$PlaceofBirth))
names(PlaceofBirth_frequence)<- c("PlaceofBirth","Counts")
PlaceofBirth_frequence

ggplot(data=PlaceofBirth_frequence, aes(x = PlaceofBirth, y = Counts, fill=PlaceofBirth))+geom_bar(stat = "identity")+ggtitle(label = "PlaceofBirth Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("PlaceofBirth")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```

```{r}

ggplot(data = E, aes(x = PlaceofBirth, fill = Class)) + geom_bar() +
    labs(x = "PlaceofBirth", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))+ scale_fill_discrete(limits=c("H","M","L"))
```

```{r}
ggplot(data = E, aes(x = PlaceofBirth, fill = NationalITy)) + geom_bar() +
    labs(x = "PlaceofBirth", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```

```{r}
ggplot(data = E, aes(x = PlaceofBirth, fill = gender)) + geom_bar() +
    labs(x = "PlaceofBirth", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```
```{r}

ggplot(data = E, aes(x = PlaceofBirth, fill = Relation)) + geom_bar() +
    labs(x = "PlaceofBirth", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```
```{r}
ggplot(data = E, aes(x = NationalITy, fill = Relation)) + geom_bar() +
    labs(x = "PlaceofBirth", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```
```{r}
ggplot(data = E, aes(x = NationalITy, fill = ParentAnsweringSurvey)) + geom_bar() +
    labs(x = "NationalITy", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```
```{r}
ggplot(data = E, aes(x = NationalITy, fill = ParentschoolSatisfaction)) + geom_bar() +
    labs(x = "NationalITy", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```

```{r}
StageID_frequence <- as.data.frame(table(ED$StageID))
names(StageID_frequence)<- c("StageID","Counts")
StageID_frequence

ggplot(data=StageID_frequence, aes(x = StageID, y = Counts))+geom_bar(stat = "identity")+ggtitle(label = "StageID Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("StageID")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show.legend = FALSE)

```


```{r}
ggplot(data = E, aes(x = StageID, fill = gender)) + geom_bar() +
    labs(x = "StageID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```



```{r}
ggplot(data = E, aes(x = StageID, fill = Topic)) + geom_bar() +
    labs(x = "StageID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```

```{r}
ggplot(data = E, aes(x = StageID, fill = Semester)) + geom_bar() +
    labs(x = "StageID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```

```{r}
ggplot(data = E, aes(x = StageID, fill = Relation)) + geom_bar() +
    labs(x = "StageID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```

```{r}
ggplot(data = E, aes(x = StageID, fill = ParentAnsweringSurvey)) + geom_bar() +
    labs(x = "StageID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```


```{r}
ggplot(data = E, aes(x = StageID, fill = ParentschoolSatisfaction)) + geom_bar() +
    labs(x = "StageID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```

```{r}
ggplot(data = E, aes(x = StageID, fill = StudentAbsenceDays)) + geom_bar() +
    labs(x = "StageID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))
```

```{r}
ggplot(data = E, aes(x = StageID, fill = Class)) + geom_bar() +
    labs(x = "StageID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))+ scale_fill_discrete(limits=c("H","M","L"))
```

```{r}
ggplot(data = E, aes(x = GradeID, fill = StageID)) + geom_bar() +
    labs(x = "GradeID", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1))+ scale_fill_discrete(limits=c("HighSchool","MiddleSchool","lowerlevel"))
```


```{r}
ggplot(data = E, aes(x = SectionID, fill = StageID)) + geom_bar() +
    labs(x = "SectionID", y = "Student Count") +theme(axis.text.x = element_text(angle=0, hjust=1))+ scale_fill_discrete(limits=c("HighSchool","MiddleSchool","lowerlevel"))
```

```{r}
ggplot(data = E, aes(x = Topic, fill = gender)) + geom_bar() +
    labs(x = "Topic", y = "Student Count") +theme(axis.text.x = element_text(angle=90, hjust=1)) 
```


```{r}
levels(E$Class) = c('H','M','L')
ggplot(data = E, aes(x = Topic, fill = Class)) + geom_bar() +
    labs(x = "Topic", y = "Student Count") + ggtitle(label = "Topic Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Topic")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1))+ scale_fill_discrete(limits=c("H","M","L"))

```


```{r}
GradeID_frequence <- as.data.frame(table(ED$GradeID))
names(GradeID_frequence)<- c("GradeID","Counts")
GradeID_frequence

ggplot(data=GradeID_frequence, aes(x = GradeID, y = Counts, fill=GradeID))+geom_bar(stat = "identity")+ggtitle(label = "GradeID Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("GradeID")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```


```{r}
SectionID_frequence <- as.data.frame(table(ED$SectionID))
names(SectionID_frequence)<- c("SectionID","Counts")
SectionID_frequence

ggplot(data=SectionID_frequence, aes(x = SectionID, y = Counts, fill=SectionID))+geom_bar(stat = "identity")+ggtitle(label = "SectionID Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("SectionID")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```

```{r}
Topic_frequence <- as.data.frame(table(ED$Topic))
names(Topic_frequence)<- c("Topic","Counts")
Topic_frequence

ggplot(data=Topic_frequence, aes(x = Topic, y = Counts, fill=Topic))+geom_bar(stat = "identity")+ggtitle(label = "Topic Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Topic")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```



```{r}
Semester_frequence <- as.data.frame(table(ED$Semester))
names(Semester_frequence)<- c("Semester","Counts")
Semester_frequence

ggplot(data=Semester_frequence, aes(x = Semester, y = Counts, fill=Semester))+geom_bar(stat = "identity")+ggtitle(label = "Semester Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Semester")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```

```{r}
Relation_frequence <- as.data.frame(table(ED$Relation))
names(Relation_frequence)<- c("Relation","Counts")
Relation_frequence

ggplot(data=Relation_frequence, aes(x = Relation, y = Counts, fill=Relation))+geom_bar(stat = "identity")+ggtitle(label = "Relation Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Relation")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```

```{r}
ParentAnsweringSurvey_frequence <- as.data.frame(table(ED$ParentAnsweringSurvey))
names(ParentAnsweringSurvey_frequence)<- c("ParentAnsweringSurvey","Counts")
ParentAnsweringSurvey_frequence

ggplot(data=ParentAnsweringSurvey_frequence, aes(x = ParentAnsweringSurvey, y = Counts, fill=ParentAnsweringSurvey))+geom_bar(stat = "identity")+ggtitle(label = "ParentAnsweringSurvey Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("ParentAnsweringSurvey")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```


```{r}
ParentschoolSatisfaction_frequence <- as.data.frame(table(ED$ParentschoolSatisfaction))
names(ParentschoolSatisfaction_frequence)<- c("ParentschoolSatisfaction","Counts")
ParentschoolSatisfaction_frequence

ggplot(data=ParentschoolSatisfaction_frequence, aes(x = ParentschoolSatisfaction, y = Counts, fill=ParentschoolSatisfaction))+geom_bar(stat = "identity")+ggtitle(label = "ParentschoolSatisfaction Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("ParentschoolSatisfaction")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show_guide = FALSE)

```

```{r}
StudentAbsenceDays_frequence <- as.data.frame(table(ED$StudentAbsenceDays))
names(StudentAbsenceDays_frequence)<- c("StudentAbsenceDays","Counts")
StudentAbsenceDays_frequence

ggplot(data=StudentAbsenceDays_frequence, aes(x = StudentAbsenceDays, y = Counts, fill=StudentAbsenceDays))+geom_bar(stat = "identity")+ggtitle(label = "StudentAbsenceDays Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("StudentAbsenceDays")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1)) + geom_text(aes(label = Counts, vjust = 0), show.legend = FALSE)

```

```{r}
Class_frequence <- as.data.frame(table(ED$Class, ED$Gender))
names(Class_frequence)<- c("Class", "Gender", "Counts")
Class_frequence

ggplot(data=Class_frequence, aes(x = Class, y = Counts, fill=Gender))+geom_bar(stat = "identity")+ggtitle(label = "Class Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Class")+ylab("Counts") + geom_text(aes(label = Counts, vjust = 0), show.legend = FALSE)

```


```{r}
ggplot(data = E, aes(x = Topic, fill = Class)) + geom_bar() +
    labs(x = "Topic", y = "Student Count") + ggtitle(label = "Topic Distribution")+theme_grey()+theme(plot.title = element_text(hjust = 0.5, lineheight = 0.8, face = "bold"))+xlab("Topic")+ylab("Counts")+theme(axis.text.x = element_text(angle=90, hjust=1))+ scale_fill_discrete(limits=c("H","M","L"))

```

# Summary of Task 1.1:


# Task 1.2. Histogram of numerical values distribution:


VisitedResources=E$VisITedResources, AnnouncementsView=E$AnnouncementsView, Discussion=E$Discussion,  

```{r}
ggplot(E, aes(x = raisedhands, fill = Class)) +
        geom_histogram(binwidth = 5, colour = "black") +
        scale_x_continuous(name = "Raised Hands",
                           breaks = seq(0, 100, 5),
                           limits=c(0, 100)) + 
        scale_y_continuous(name = "Count") +
        ggtitle("Frequency histogram of Raised Hands") + scale_fill_discrete(limits=c("H","M","L"))


```

```{r}
ggplot(E, aes(x = VisITedResources, fill = Class)) +
        geom_histogram( binwidth = 5, colour = "black") +
        scale_x_continuous(name = "VisITedResources",
                           breaks = seq(0, 100, 5),
                           limits=c(0, 100)) + 
        scale_y_continuous(name = "Count") +
        ggtitle("Frequency histogram of VisITedResources")+ scale_fill_discrete(limits=c("H","M","L"))


```

```{r}
ggplot(E, aes(x = AnnouncementsView, fill = Class)) +
        geom_histogram( binwidth = 5, colour = "black") +
        scale_x_continuous(name = "AnnouncementsView",
                           breaks = seq(0, 100, 5),
                           limits=c(0, 100)) + 
        scale_y_continuous(name = "Count") +
        ggtitle("Frequency histogram of AnnouncementsView") + scale_fill_discrete(limits=c("H","M","L"))


```

```{r}
ggplot(E, aes(x = Discussion, fill = Class)) +
        geom_histogram(binwidth = 5, colour = "black") +
        scale_x_continuous(name = "Discussion",
                           breaks = seq(0, 100, 5),
                           limits=c(0, 100)) + 
        scale_y_continuous(name = "Count") +
        ggtitle("Frequency histogram of Discussion") + scale_fill_discrete(limits=c("H","M","L"))


```

# Summary of Task 1.2:



#Task 2. Exporation of the relationships between different features of the students' academic performance datasets

#Task 2.1. Boxplot

```{r}
ggplot(data = E, aes(x = gender, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = gender, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = gender, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = gender, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = NationalITy, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = NationalITy, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = NationalITy, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = NationalITy, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = StageID, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = StageID, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = StageID, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = StageID, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = Topic, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = Topic, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = Topic, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = Topic, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = SectionID, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = SectionID, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = SectionID, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = SectionID, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = Semester, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = Semester, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = Semester, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = Semester, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = Relation, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = Relation, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = Relation, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = Relation, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = ParentAnsweringSurvey, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = ParentAnsweringSurvey, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = ParentAnsweringSurvey, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = ParentAnsweringSurvey, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = ParentschoolSatisfaction, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = ParentschoolSatisfaction, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = ParentschoolSatisfaction, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = ParentschoolSatisfaction, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = StudentAbsenceDays, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = StudentAbsenceDays, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = StudentAbsenceDays, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = StudentAbsenceDays, y = Discussion)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = Class, y = raisedhands)) + geom_boxplot()
```


```{r}
ggplot(data = E, aes(x = Class, y = VisITedResources)) + geom_boxplot()

```
```{r}
ggplot(data = E, aes(x = Class, y = AnnouncementsView)) + geom_boxplot()
```

```{r}
ggplot(data = E, aes(x = Class, y = Discussion)) + geom_boxplot()
```


#Task 3. Prediction of the students' academic performance. Build prediction model and evaluate the results of the model

#Prediction model 1 --- Decision tree
```{r create training and test data 1}
# Decision trees use probability to choose how to split, so here we "seed" a random number generator so our results are always the same.
set.seed(55)

# Split the data into 70% training, 30% test: this means we use 70% of the dataset to build our predictive model. We then use the remaining 30% of data as the unseen data (test) in order to evaluate the predictions.
ind <- sample(2, nrow(E), replace=TRUE, prob=c(0.75, 0.25))
train_data <- E[ind==1,]
test_data <- E[ind==2,]
```


Use the training data to train a model.
Since the "sequece" column is just the accession number for the SWISS-PORT data base, it will not be included in the formula of the tree.

```{r}
formula <- Class ~ gender + NationalITy + PlaceofBirth + StageID + GradeID + SectionID + Topic + Semester + Relation + raisedhands + VisITedResources + AnnouncementsView + Discussion + ParentAnsweringSurvey + ParentschoolSatisfaction + StudentAbsenceDays

E_ctree <- ctree(formula, data = train_data)
```

```{r, fig.width=20, fig.height=8}
plot(E_ctree)
```


```{r view predictions 1}
tree.predict <- predict(E_ctree, newdata = test_data)
confusionMatrix(tree.predict, test_data$Class)
```

# Heatmap
```{r}
E_table <- table(tree.predict, test_data$Class)
E_melt <- melt(E_table)
names(E_melt) <- c("Prediction", "Reference", "Value")
E_melt$Value <- (E_melt$Value - min(E_melt$Value))/(max(E_melt$Value) - min(E_melt$Value))
E_melt

ggplot(E_melt, aes(x=Reference, y=Prediction, fill=Value)) + geom_tile() + scale_fill_gradient(low = "white",high = "red") + scale_x_discrete(position = "top") + scale_y_discrete(limits = rev(levels(E_melt$Prediction)))
```



#model 2

```{r}
library(caret)
rpart.control = trainControl(method = "repeatedcv", number = 10, repeats = 3)
rpart.grid = expand.grid(.cp = seq(0.01, 0.5, 0.02))
rpart.model.caret <-train(formula, data = train_data, method = "rpart", preProcess = "scale",
                          trControl = rpart.control, tuneGrid = rpart.grid)

rpart.predict.caret <- predict.train(rpart.model.caret, test_data)

confusionMatrix(rpart.predict.caret, test_data$Class)

```


#model 3
```{r}
library(randomForest)
set.seed(10)

rf.model <- randomForest(Class ~ .- SectionID , data = train_data, importance = TRUE,
                         ntree = 2000, nodesize = 20)

rf.predict <- predict(rf.model, test_data)
confusionMatrix(test_data$Class, rf.predict)
```

```{r}
varImpPlot(rf.model)
```


#model 4
```{r}
cforest.model = cforest(Class ~ .-SectionID , data = train_data,
                        controls=cforest_unbiased(ntree=2000, mtry = 3))

cforest.prediction = predict(cforest.model, test_data, OOB = TRUE, type = "response")
confusionMatrix(test_data$Class, cforest.prediction)
```


#model 5 Suppost Vector Machines
```{r}
library(e1071)
svm.model <- svm(Class ~ ., data = train_data, kernel = "radial", cost = 10, gamma = 0.15)
svm.predict <- predict(svm.model, test_data)
confusionMatrix(test_data$Class, svm.predict)
```


#model 6 Ensemble
```{r}
library(class)
library(caret)
library(caTools)
library(party)
results <- data.frame(tree = tree.predict, rpart = rpart.predict.caret, rf = rf.predict,
                        cforest = cforest.prediction, svm = svm.predict,
                        actual.class = test_data$Class, final.prediction = rep("-",nrow(test_data)))

results
```

```{r}
getmode <- function(x) {
    unique.x <- unique(x)
    unique.x[which.max(tabulate(match(x, unique.x)))]
}

results$final.prediction <- apply(results, 1, getmode)
confusionMatrix(results$actual.class, results$final.prediction)
```














